/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/ctrling@0.8.13/ctrling.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * ctrling.js (c) 2022/23 Stefan Goessner
 * @license MIT License
 */
"use strict";class Ctrling extends HTMLElement{static get observedAttributes(){return["ref","width","top","right","darkmode","autoupdate","autogenerate","tickspersecond","callback"]}#t;#e=!1;#n;#i;#s=[];#a=!1;#r=4;#l;constructor(){super().attachShadow({mode:"open"}),this.shadowRoot.innerHTML=Ctrling.template({width:this.getAttribute("width")||"200px",top:this.getAttribute("top")||"0px",right:this.getAttribute("right")||"0px"}),this.#t=this.shadowRoot.querySelector("main")}connectedCallback(){window.setTimeout((()=>this.#o()))}disconnectedCallback(){for(const t of this.#s)this.#c(t);this.#a&&window.clearInterval(this.#a)}attributeChangedCallback(name,oldval,val){if("ref"===name&&this.#e){const ref=/[A-Za-z_][A-Za-z_0-9]*/.test(val)?val:"";this.#i=ref&&(globalThis[ref]||eval(ref))}else if("width"===name)this.style.setProperty("width",val);else if("right"===name)this.#t.style.setProperty("right",val);else if("top"===name)this.#t.style.setProperty("top",val);else if("darkmode"===name)""===this.getAttribute("darkmode")?(this.style.setProperty("--bkg-1","var(--dark-bkg-1)"),this.style.setProperty("--bkg-2","var(--dark-bkg-2)"),this.style.setProperty("--bkg-3","var(--dark-bkg-3)"),this.style.setProperty("--col-1","var(--dark-col-1)"),this.style.setProperty("--col-2","var(--dark-col-2)"),this.style.setProperty("--col-3","var(--dark-col-3)")):(this.style.setProperty("--bkg-1","var(--lite-bkg-1)"),this.style.setProperty("--bkg-2","var(--lite-bkg-2)"),this.style.setProperty("--bkg-3","var(--lite-bkg-3)"),this.style.setProperty("--col-1","var(--lite-col-1)"),this.style.setProperty("--col-2","var(--lite-col-2)"),this.style.setProperty("--col-3","var(--lite-col-3)"));else if("autoupdate"===name&&this.#e)this.#a=window.setInterval((()=>this.updateControlValues()),1e3/this.#r);else if("autogenerate"===name&&this.#e)this.#u("src"===val||"source"===val);else if("callback"===name&&this.#e){const[t,e]=this.#h(val),n=t&&e&&Object.getOwnPropertyDescriptor(t,e);void 0!==n&&"value"in n&&"function"==typeof t[e]&&(this.#l=t===globalThis?t[e]:t[e].bind(t))}else if("tickspersecond"===name){const t=+val;Number.isNaN(t)||(this.#r=Math.min(t,60),this.#a&&(window.clearInterval(this.timer),this.#a=window.setInterval((()=>this.updateControls()),1e3/this.#r)))}}#o(){this.#e=!0,this.hasAttribute("ref")&&this.setAttribute("ref",this.getAttribute("ref")),this.hasAttribute("callback")&&this.setAttribute("callback",this.getAttribute("callback")),this.hasAttribute("autogenerate")&&this.setAttribute("autogenerate",this.getAttribute("autogenerate")),this.hasAttribute("autoupdate")&&this.setAttribute("autoupdate",this.getAttribute("autoupdate"));const t=this.innerHTML.trim();t&&this.#p(t),this.style.display="block",this.style.height=this.offsetHeight+"px",this.#t.style.width=this.offsetWidth+"px",this.#n&&"function"==typeof this.#n&&this.#n(this),this.#l&&this.#l({ctrl:this})}#p(t){try{this.#s.push(...JSON.parse(t));for(let t=0;t<this.#s.length;t++)this.#t.append(this.#d(this.#s[t]));return this.#s}catch(t){this.#s=[],this.addSection({sec:"hdr",text:"Ctrling: "+t.message})}return this.#s}#u(t){if("object"==typeof this.#i){const e=this.#i,n=Object.getOwnPropertyNames(e),i={boolean:"chk",number:"num",string:"txt"};this.addSection({sec:"hdr",text:`Generated for: ${this.getAttribute("ref")}`});for(const t of n)!t.startsWith("_")&&["boolean","number","string"].includes(typeof e[t])&&this.addSection({sec:`${i[typeof e[t]]}`,label:t,path:`$['${t}']`});if(t){const t=JSON.stringify(this.#s).replaceAll("},","},\n ").replaceAll(/(,"_hdls":\[[^\]]*\])/gm,"");this.addSection({sec:"out",label:"src=",value:t})}}}#h(t){const e=void 0===t?void 0:t.startsWith("$")?this.#i:t.match(/^(window|globalThis)/)?globalThis:void 0;if(e){const n=t.match(/^(\$|window|globalThis)/)&&t.endsWith("]")?t.substring(t.search(/\[/)+1,t.length-1).replaceAll("'","").split("]["):void 0;let i=e;if(n&&n.length>0){for(let t=0;t<n.length-1;t++)i=i[n[t]];return[i,n[n.length-1]]}return[i]}return[]}#g(t,e,n){return t?e?t[e]:t:n}#m(t,e,n,i,s){if(n=!0===n||!1===n||null===n||Number.isNaN(+n)?n:+n,t[e]=n,void 0!==this.#l){const a=this;console.log({ctrl:a,obj:t,member:e,value:n,section:i,elem:s}),this.#l({ctrl:a,obj:t,member:e,value:n,section:i,elem:s})}return n}#b(t,e){for(const t of e)t.elem.addEventListener(t.type,t.hdl,!0);t._hdls=e}#c(t){if(t._hdls)for(const e of t._hdls)e.elem.removeEventListener(e.type,e.hdl,!0);delete t._hdls}#d(t){if(t&&t.sec&&Object.hasOwn(Ctrling.prototype,t.sec)){const e=document.createElement("section");return e.setAttribute("class",t.sec),this[t.sec](e,t),e}}oninit(t){this.#n=t}setAttr(t,e){return this.setAttribute(t,e),this}removeAttr(t){return this.removeAttribute(t),this}section(t){return this.#s[t]}findSectionIndex(t){return this.#s.findIndex(t)}addSection(t){const e=this.#d(t);return e&&(this.#t.append(e),this.#s.push(t)),this}insertSection(t,e){if(t>=0){const n=this.#d(e);n&&(this.#t.getElementsByTagName("section")[t]?.insertAdjacentElement("afterend",n),this.#s.splice(t+1,0,e))}return this}removeSection(t){return t>=0&&(this.#c(this.#s[t]),this.#t.getElementsByTagName("section")[t]?.remove(),this.#s.splice(t,1)),this}updateSection(t,e){if(t>=0){void 0!==e?(this.#c(this.#s[t]),this.#s.splice(t,1,e)):e=this.#s[t];const n=this.#d(e);n&&this.#t.getElementsByTagName("section")[t]?.replaceWith(n)}return this}updateControlValues(){for(const t of this.#s)t._upd&&t._upd();return this}hdr(t,e){return t.innerHTML=`${e.text||""}`,t}chk(t,e){const[n,i]=this.#h(e.path);t.innerHTML=`<label>${e.label||"&nbsp;"}<input type="checkbox" ${this.#g(n,i,e.value)?"checked":""}${e.disabled?" disabled":""}></label>`;const s=t.querySelector("input");return this.#b(e,[{type:"input",elem:t.querySelector("input"),hdl:s=>this.#m(n,i,!!s.target.checked,e,t)}]),e._upd=()=>{s.checked=n[i]?"checked":""},t}col(t,e){const[n,i]=this.#h(e.path),s=this.#g(n,i,e.value||"#000000");t.innerHTML=`${e.label||"&nbsp;"}<span><input type="color" value="${s}"${e.disabled?" disabled":""}><output>${s}</output></span>`;const a=t.querySelector("input");return this.#b(e,[{type:"input",elem:a,hdl:s=>{a.nextSibling.innerHTML=this.#m(n,i,s.target.value,e,t)}}]),e._upd=()=>{a.nextSibling.innerHTML=a.value=this.#g(n,i,"#000000")},t}num(t,e){const[n,i]=this.#h(e.path),s=this.#g(n,i,e.value||0),a=(t,e)=>e?t.toFixed(e):t;t.innerHTML=`<label>${e.label||"&nbsp;"}<span><input type="number" value="${a(s,e.fractions)}"${void 0!==e.min?` min="${e.min}"`:""}${void 0!==e.max?` max="${e.max}"`:""}${void 0!==e.step?` step="${e.step}"`:""}${e.disabled?" disabled":""}>${e.unit?`<span>${e.unit}</span>`:""}</span></label>`;const r=t.querySelector("input");return this.#b(e,[{type:"input",elem:r,hdl:s=>this.#m(n,i,a(+s.target.value,e.fractions),e,t)},{type:"change",elem:r,hdl:s=>this.#m(n,i,s.target.value=a(+s.target.value,e.fractions),e,t)}]),e._upd=()=>{r.value=this.#g(n,i,0)},t}txt(t,e){const[n,i]=this.#h(e.path);t.innerHTML=`<label>${e.label||"&nbsp;"}<input type="text" value="${this.#g(n,i,e.value||"")}"${e.disabled?" disabled":""}></label>`;const s=t.querySelector("input");return this.#b(e,[{type:"input",elem:s,hdl:s=>this.#m(n,i,s.target.value,e,t)}]),e._upd=()=>{s.value=this.#g(n,i,"?")},t}rng(t,e){const[n,i]=this.#h(e.path),s=this.#g(n,i,e.value);t.innerHTML=`${e.label||"&nbsp;"}<span><input type="range" value="${s}"${void 0!==e.min?` min="${e.min}"`:""}${void 0!==e.max?` max="${e.max}"`:""}${void 0!==e.step?` step="${e.step}"`:""}${e.disabled?" disabled":""}><output>${s}</output>${e.unit?`<span>${e.unit}</span>`:""}`;const a=t.querySelector("input");return this.#b(e,[{type:"input",elem:a,hdl:s=>{a.nextSibling.innerHTML=this.#m(n,i,+s.target.value,e,t)}}]),e._upd=()=>{a.nextSibling.innerHTML=a.value=this.#g(n,i,0)},t}sel(t,e){const[n,i]=this.#h(e.path),s=Array.isArray(e.options)?e.options.map((t=>[t,t])):Object.entries(e.options),a=this.#g(n,i,s[0][1]);t.innerHTML=`${e.label||"&nbsp;"}<select${e.disabled?" disabled":""}>${s.map((t=>`<option value="${t[1]}"${t[1]===a?" selected":""}>${t[0]}</option>`)).join("")}</select>`;const r=t.querySelector("select");return this.#b(e,[{type:"input",elem:r,hdl:s=>this.#m(n,i,isNaN(s.target.value)?s.target.value:+s.target.value,e,t)}]),e._upd=()=>{r.value=this.#g(n,i,s[0][1])},t}sep(t){return t.innerHTML="<hr>",t}btn(t,e){if(t.innerHTML=`${e.text&&e.label||"&nbsp;"}<button type="button"${e.disabled?" disabled":""}>${e.text||e.label}</button`,e.path&&!e.disabled){const[n,i]=this.#h(e.path),s=n&&i&&Object.getOwnPropertyDescriptor(n,i);void 0!==s&&"value"in s&&"function"==typeof n[i]&&this.#b(e,[{type:"click",elem:t.querySelector("button"),hdl:n===globalThis?n[i]:n[i].bind(n)}])}return t}out(t,e){const[n,i]=this.#h(e.path),s=Ctrling.stringify(this.#g(n,i,e.value||""));if(t.innerHTML=`${e.label||"&nbsp;"}<span><output>${s}</output>${e.unit?`<span>${e.unit}</span>`:""}</span>`,void 0!==n){const s=t.querySelector("output");e._upd=()=>{const t=Ctrling.stringify(i?n[i]:n);s.innerHTML!==t&&(s.innerHTML=t)}}return t}mtr(t,e){const[n,i]=this.#h(e.path),s=this.#g(n,i,e.value||e.min||0);if(t.innerHTML=`${e.label||"&nbsp;"}<span><meter value="${s}"${void 0!==e.min?` min="${e.min}"`:""}${void 0!==e.max?` max="${e.max}"`:""}${void 0!==e.low?` low="${e.low}"`:""}${void 0!==e.high?` high="${e.high}"`:""}${void 0!==e.optimum?` optimum="${e.optimum}"`:""}></meter><output>${s}</output>${e.unit?`<span>${e.unit}</span>`:""}</span>`,void 0!==n){const s=t.querySelector("meter"),a=t.querySelector("output");e._upd=()=>{const t=i?n[i]:n;s.value!==t&&(s.value=a.value=t)}}return t}vec(t,e){if(Array.isArray(e.path)&&e.path.length>0){t.innerHTML=`${e.label||"&nbsp;"}<span>${e.path.map((t=>{const[n,i]=this.#h(t);return`<input type="text" ${n?` value="${Ctrling.stringify(n[i])}"`:""}${e.disabled?" disabled":""}${e.width?` style="width:${e.width}"`:""}>`})).join("")}</span>${e.unit?`<span>${e.unit}</span>`:""}`;const n=t.getElementsByTagName("input"),i=[];for(let s=0;s<n.length;s++)n[s]._ctrlpath=e.path[s],i.push({type:"input",elem:n[s],hdl:n=>{const[i,s]=this.#h(n.target._ctrlpath);this.#m(i,s,isNaN(n.target.value)?n.target.value:+n.target.value,e,t)}});this.#b(e,i),e._upd=()=>{for(let t=0;t<n.length;t++){const[e,i]=this.#h(n[t]._ctrlpath);n[t].value=this.#g(e,i,0)}}}return t}static stringify(t){return Array.isArray(t)?JSON.stringify(t):"object"==typeof t?JSON.stringify(t).replaceAll(/\[.*?\]/gm,(t=>t.replaceAll(",",";"))).replaceAll(/\:\{([^}]*?)\}/gm,(t=>t.replaceAll(",",";"))).replace(/^\{/gm,"{\n  ").replace(/\}$/gm,"\n}").replaceAll(",",",\n  ").replaceAll(";",","):"string"==typeof t?t:JSON.stringify(t)}static template({width:t,top:e,right:n}){return`\n<style>\n:host {\n    --dark-bkg-1: #555;\n    --dark-bkg-2: #666;\n    --dark-bkg-3: #777;\n\n    --dark-col-1: #fff;\n    --dark-col-2: #eee;\n    --dark-col-3: #bbb;\n\n    --lite-bkg-1: #dadada;\n    --lite-bkg-2: #efefef;\n    --lite-bkg-3: #c0c0c0;\n\n    --lite-col-1: #444;\n    --lite-col-2: #222;\n    --lite-col-3: #777;\n\n    --bkg-1: var(--lite-bkg-1);\n    --bkg-2: var(--lite-bkg-2);\n    --bkg-3: var(--lite-bkg-3);\n\n    --col-1: var(--lite-col-1);\n    --col-2: var(--lite-col-2);\n    --col-3: var(--lite-col-3);\n\n    width: ${t};\n}\n\nmain {\n    /* grid layout */\n    display: grid;\n    grid: minmax(200px,100%);\n    border-radius:5px;\n    padding: 0 2px 0 2px;\n    width: ${t};\n    min-width: 200px;\n    background-color: var(--bkg-1);\n    overflow: hidden;\n\n    font-family: monospace;\n\n    /* top right corner position */\n    position: absolute;\n    top: ${e};\n    right: ${n};\n    user-select: none;\n}\nmain > section {\n    width: 100%;\n    margin: 2px 0 2px 0;\n}\nmain > section.hdr {\n    text-align: center;\n    font-weight: bold;\n    color: var(--col-1);\n    background-color: var(--bkg-3);\n    border-radius: 5px 5px 0 0;\n}\nmain > section.btn, \nmain > section.sel, \nmain > section.rng, \nmain > section.col, \nmain > section.out, \nmain > section.mtr,\nmain > section.vec,\nmain > section > label  {\n    display: flex;\n    flex-wrap: nowrap;\n    justify-content: space-between;\n    align-items: center;\n    gap: 0.25em;\n\n    color: var(--col-2);\n\n    border-radius: 0px;\n    border: none;\n}\nmain > section > span {\n    display: flex;\n    flex-wrap: nowrap;\n    justify-content: space-between;\n    align-items: center;\n    gap: 0.1em;\n}\nmain > section input:not([disabled]):hover {\n    background-color: var(--bkg-3);\n}\nmain > section input:focus-visible {\n    color: var(--col-1);\n    outline: 1px solid var(--col-2);\n}\nmain > section input {\n    background-color: var(--bkg-2);\n    color: var(--col-1);\n    border: none;\n    font-family: monospace;\n}\nmain > section output {\n    background-color: var(--bkg-1);\n    padding: 0 0.25em;\n    font-family: monospace;\n    white-space: pre;\n}\nmain > section select, \nmain > section button {\n    font-family: monospace;\n}\n\nmain > section.num input {\n    width: 5em;\n}\nmain > section.col input {\n    width: 2em;\n}\nmain > section.rng input {\n    width: 7em;\n}\nmain > section.vec input {\n    width: 23%;\n}\nmain > section.vec > span {\n    display: flex;\n    flex-flow: row wrap;\n    justify-content: end;\n    gap: 1px;\n}\nmain > section.out {\n    min-width: 2em;\n    max-width: 100%;\n    overflow: hidden;\n}\nmain > section.out output {\n    user-select: text;\n}\nmain > section.rng output {\n    width: 1.5em;\n    text-align: right;\n}\nmain > section.sep > hr {\n    color: var(--bkg-3);\n    width: 90%;\n}\nmain > section input:disabled {\n    background-color: var(--bkg-1);\n    color: var(--col-3);\n}\n</style>\n<main></main>`}}customElements.define("ctrl-ing",Ctrling);
